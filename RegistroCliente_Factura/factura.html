<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Factura - Modric Estudio</title>
    <link rel="stylesheet" href="factura.css" />
  </head>
  <body>
    <div class="contenedor-factura">
      <header>
        <div class="logo">
          <!-- AquÃ­ colocarÃ¡s la imagen definitiva -->
          <img src="../imagenes/logo.png" alt="Ejemplo CarnÃ© Estudiantil" />
        </div>
        <div class="info-empresa">
          <h1>MODRIC ESTUDIO</h1>
          <p><strong>Borcelle</strong></p>
          <p>Calle Cualquiera 123,<br />Cualquier Lugar, CP: 12345</p>
          <p>hola@unsitiogenial.es</p>
          <p>91-1234-567</p>
        </div>
        <div class="info-factura">
          <p><strong>FACTURA NÂº:</strong> <span id="numeroFactura"></span></p>
          <p><strong>Fecha:</strong> <span id="fechaFactura"></span></p>
          <p><strong>Vendedor:</strong> <span id="facturaVendedor"></span></p>
        </div>
      </header>

      <section class="datos">
        <div class="col">
          <h3>Datos cliente</h3>
          <p id="clienteNombre"></p>
          <p id="clienteDireccion"></p>
          <p id="clienteCorreo"></p>
          <p id="clienteTelefono"></p>
        </div>
      </section>

      <table class="tabla-productos">
        <thead>
          <tr>
            <th>DescripciÃ³n / Producto</th>
            <th>Base</th>
            <th>ITBMS</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="tablaProductos"></tbody>
      </table>
      <section class="comentario">
        <h3>Comentario del cliente</h3>
        <p id="comentarioCliente">No se ingresÃ³ ningÃºn comentario.</p>
      </section>

      <div class="total">
        <p><strong>Total:</strong> <span id="totalFactura"></span></p>
      </div>

      <footer>
        <p>
          El pago se realizarÃ¡ en un plazo de tres meses desde la emisiÃ³n de
          esta factura,<br />
          se realizarÃ¡ mediante transferencia bancaria.
        </p>
      </footer>
    </div>

    <script>
      function generarPDF() {
        const facturaData = JSON.parse(localStorage.getItem("facturaData"));
        let totalFactura = 0;

        facturaData.productos.forEach((p) => {
          totalFactura += parseFloat(p.total);
        });
        let factura = {
          // Obtenemos todos los datos que ya estÃ¡n en pantalla
          numero: document.getElementById("numeroFactura").textContent,
          fecha: document.getElementById("fechaFactura").textContent,
          clienteNombre: document.getElementById("clienteNombre").textContent,
          clienteCorreo: document.getElementById("clienteCorreo").textContent,
          metodoPago: facturaData.metodoPago,
          paquete: facturaData.paquete,
          total: totalFactura,
          comentario: facturaData.comentario,
        };
        // Enviamos los datos al PHP por POST
        console.log(factura);
        fetch("../php/facturas_pdf.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(factura),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.exito) {
              alert("Factura PDF generada correctamente");
              var link = document.createElement("a");
              link.href = data.url;
              link.download = "factura.pdf";
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
            } else {
              alert("Error al generar el PDF");
            }
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
    <div class="acciones-factura">
      <button id="btnGenerarPDF" class="btn-pdf" onclick="generarPDF()">
        ðŸ“„ Generar PDF
      </button>

      <button id="btnWhatsApp" class="btn-whatsapp" >
        ðŸ“± Enviar por WhatsApp
      </button>
    </div>

    <script src="factura.js"></script>
  </body>
</html>
